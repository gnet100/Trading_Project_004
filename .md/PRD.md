# Product Requirements Document (PRD)
# פרויקט אפליקציית מסחר - Trading Project 004

## 1. מטרת הפרויקט

פיתוח אפליקציית מסחר מתקדמת הכוללת ניתוח נתוני מסחר, בניית אסטרטגיות מסחר וביצוע מסחר אוטומטי באמצעות חיבור לאינטראקטיב ברוקר (IB).

## 2. יעדי המוצר

### 2.1 יעדים עסקיים
- פיתוח מערכת מסחר אוטומטית מבוססת נתונים
- יכולת ניתוח סטטיסטי מעמיק של נתוני מסחר
- אופטימיזציה של אסטרטגיות מסחר
- הפחתת התלות בהחלטות מסחר ידניות

### 2.2 יעדים טכניים
- חיבור יציב ואמין לאינטראקטיב ברוקר
- מאגר נתונים מקומי עם יכולות חיפוש מהירות
- מערכת בקטטסטינג מדויקת
- ממשק משתמש אינטואיטיבי לניהול האסטרטגיות

## 3. תיאור הפתרון

### 3.1 תמצית המוצר
אפליקציית מסחר המורכבת מארבעה מודולים עיקריים:
1. מודול הורדת נתונים מ-IB
2. מאגר נתונים מקומי עם יכולות ניתוח
3. מערכת בקטטסטינג ואופטימיזציה
4. מערכת ביצוع מסחר אוטומטי

### 3.2 נתוני המסחר
**מקור הנתונים:** אינטראקטיב ברוקר (IB)

**סוגי נתונים:**
- נתוני בר: גבוה, נמוך, פתיחה, סגירה, ווליום
- חותמות זמן: תאריך ושעה מדויקת
- מסגרות זמן מרובות: דקה, 15 דקות, שעה, 4 שעות, יומי

**היקף הנתונים:**
- תקופה: שנתיים לאחור
- הערכת כמות: כ-3 מיליון רשומות
- עדכון: בזמן אמת (בשלבים מתקדמים)

## 4. שלבי הפיתוח

### שלב 1: הקמת תשתית נתונים
- חיבור לממשק IB API
- הורדת נתונים היסטוריים
- הקמת מאגר נתונים מקומי
- מערכת בקרת איכות ואמינות נתונים
- הקמת מערכת Github Backup

### שלב 2: מערכת ניתוח סטטיסטי
- פיתוח כלי ניתוח נתונים
- יצירת דוחות סטטיסטיים
- זיהוי דפוסי מסחר
- ויזואליזציה של נתונים

### שלב 3: בקטטסטינג ואסטרטגיות
- מערכת בקטטסטינג מדויקת
- פיתוח אסטרטגיות מסחר
- בדיקת ביצועים היסטוריים
- הערכת סיכונים ותשואות

### שלב 4: אופטימיזציה וביצוע
- אופטימיזציה של פרמטרים
- מערכת ביצוע מסחר אוטומטי
- ניהול סיכונים
- מעקב ביצועים בזמן אמת

## 5. דרישות טכניות

### 5.1 טכנולוגיות מוצעות
- **שפת תכנות:** Python (ראשי)
- **מאגר נתונים:** SQLite/PostgreSQL
- **חיבור IB:** Interactive Brokers API / TWS API
- **ניתוח נתונים:** pandas, numpy, scipy
- **ויזואליזציה:** matplotlib, plotly

### 5.2 דרישות מערכת
- חיבור אינטרנט יציב
- חשבון אינטראקטיב ברוקר פעיל
- מערכת הפעלה: Windows/Linux/Mac
- זיכרון: מינימום 8GB RAM
- שטח אחסון: 100GB עבור נתוני 2 שנים

### 5.3 דרישות אמינות
- גיבוי אוטומטי של מאגר הנתונים
- בקרת שלמות נתונים
- מערכת התחברות מחדש אוטומטית
- רישום פעולות (logging) מפורט
- מנגנוני התאוששות משגיאות

## 6. אבני דרך ולוח זמנים

### מחזור 1 (4-6 שבועות)
- הקמת חיבור IB
- פיתוח מודול הורדת נתונים
- יצירת מאגר נתונים בסיסי

### מחזור 2 (3-4 שבועות)
- מערכת ניתוח סטטיסטי
- כלי ויזואליזציה
- דוחות ניתוח ראשוניים

### מחזור 3 (4-5 שבועות)
- מערכת בקטטסטינג
- פיתוח אסטרטגיות בסיסיות
- בדיקת ביצועים

### מחזור 4 (3-4 שבועות)
- אופטימיזציה מתקדמת
- מערכת ביצוע אוטומטי
- ניהול סיכונים

## 7. רכיבים טכניים מפורטים

### 7.1 IB Connection Module
- חיבור TWS/Gateway עם טיפול ב-rate limiting ושגיאות
- Historical data requests מבוקרים
- Real-time data capabilities
- מנגנוני התחברות מחדש אוטומטיים

### 7.2 Data Storage System
- רזולוציות זמן מרובות עם validation ו-cleansing
- Schema optimization לביצועים מהירים
- Data integrity checks
- Backup ו-recovery mechanisms

### 7.3 Analysis Engine
- Technical indicators library מקיפה
- Statistical analysis tools מתקדמים
- Pattern recognition algorithms
- Performance metrics calculation

### 7.4 Dashboard System
- Web-based interface אינטואיטיבי
- Real-time data visualization
- Progress monitoring
- User management ו-access control

### 7.5 Github Backup System
- גיבויים אוטומטיים מתוזמנים
- אפשרות גיבוי ידני
- Version control לקוד ונתונים קריטיים
- Recovery procedures מתועדים

## 8. מאגר הנתונים למחקר - DNA Database

### 8.1 חזון המחקר הסטטיסטי
**מטרה עליונה:** יצירת מאגר DNA של תנועות מחיר עם יכולת חיזוי רווחיות עסקאות

**גישת המחקר:**
- כל דקת מסחר = נקודת החלטה פוטנציאלית (עסקה)
- סימולציית LONG בלבד עם Stop Loss/Take Profit קבועים
- מעקב תוצאות + אינדיקטורים טכניים
- בסיס לפיתוח מודל Machine Learning עתידי

### 8.2 פרמטרי זמן ומסחר
**שעות איסוף נתונים:**
- 09:30-09:45 EST: תקופת Warmup (איסוף בלבד, ללא עסקאות)
- 09:45-16:00 EST: שעות מסחר פעילות (איסוף + עסקאות)
- 16:00-20:00 EST: After-Market (מעקב עסקאות פתוחות)

**כללי סגירה:**
- סגירה כפויה: 30 דקות לפני סוף After-Market
- סגירת שבוע: כל העסקאות נסגרות לפני סוף שבוע

### 8.3 פרמטרי עסקאות למחקר
**מאפייני עסקה בסיסיים:**
- כיוון: LONG בלבד
- גודל: 50 מניות בכל עסקה
- Stop Loss: Entry Price - $2.8
- Take Profit: Entry Price + $3.2
- ללא הגבלת עסקאות מקבילות

**לוגיקת פתיחה/סגירה:**
- Entry Price: Open price של דקת הפתיחה
- בדיקת SL/TP: מול High/Low של כל דקה עוקבת
- Exit Price: Open price של הדקה שלאחר פגיעה ב-SL/TP
- הערה קריטית: מחיר הסגירה ≠ SL/TP (בגלל פערים)

### 8.4 מבנה מאגר הנתונים - גישה מדורגת

#### Phase 1: Historical Data Foundation (Milestone 3)
```sql
CREATE TABLE historical_data (
    id                  BIGINT AUTO_INCREMENT PRIMARY KEY,
    symbol              VARCHAR(10) DEFAULT 'MSTR',
    date                DATE,
    time                TIME,
    timestamp           DATETIME,

    -- נתוני IB גולמיים (הבסיס הקדוש)
    open_price          DECIMAL(10,4),
    high_price          DECIMAL(10,4),
    low_price           DECIMAL(10,4),
    close_price         DECIMAL(10,4),
    volume              BIGINT,

    -- Metadata איכות נתונים
    timeframe           VARCHAR(10) DEFAULT '1min',
    data_quality_score  DECIMAL(4,2) DEFAULT 100.00,
    is_trading_hours    BOOLEAN,
    is_warmup_period    BOOLEAN
);
```

#### Phase 2: Technical Indicators (עתידי)
הרחבה דינמית של עמודות אינדיקטורים לפי הצורך המתפתח במחקר

#### Phase 3: Trading Simulation (מחקר)
הוספת עמודות סימולציית מסחר לניתוח רווחיות

### 8.5 עקרונות תכנון מרכזיים
1. **מהימנות נתונים קודם כל:** 99.95%+ איכות מנתוני IB
2. **גמישות עתידית:** יכולת הוספת אינדיקטורים בהדרגה
3. **מבנה דמוי Excel:** נוח לבדיקה ולמחקר
4. **ביצועים:** אינדקסים מותאמים לשאילתות מחקר
5. **מדרגיות:** תמיכה במיליוני רשומות

## 9. גורמי סיכון מפורטים

### 9.1 סיכונים טכניים
- **IB API limitations:** הגבלות קצב בקשות, תקלות חיבור, שינויי API
- **גודל נתונים:** ביצועי מאגר נתונים, זיכרון מערכת, זמני עיבוד
- **ביצועים:** זמני תגובה איטיים, עומסי CPU גבוהים, bottlenecks

### 9.2 סיכוני נתונים
- **איכות נתונים:** נתונים שגויים מ-IB, corruption במאגר
- **נתונים חסרים:** gaps בנתונים היסטוריים, missing bars
- **שגיאות חישוב:** bugs באלגוריתמים, floating point errors

### 9.3 סיכוני פרויקט
- **Complexity creep:** הוספת features לא מתוכננות
- **Timeline overruns:** עיכובים בפיתוח, underestimation
- **Scope changes:** שינויים בדרישות, feature additions

### 9.4 מגבלות עסקיות
- תלות בשירותי IB
- דרישות רגולטוריות
- עלויות חיבור וטרנזקציות
- מגבלות על תדירות בקשות API

## 10. הערות נוספות

מסמך זה מהווה גרסה ראשונית ויתעדכן במהלך הפיתוח בהתאם למידע נוסף ולדרישות שיתגלו.

---

**נוצר:** 11/09/2025
**גרסה:** 1.2
**סטטוס:** מתעדכן - נוסף חלק Database Design למחקר סטטיסטי
**מעודכן אחרון:** 13/09/2025
